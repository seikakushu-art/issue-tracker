<section class="dashboard">
    <!-- „Éò„ÉÉ„ÉÄ„Éº: ÈÄöÁü•„Ç®„É™„Ç¢„Å®„É¶„Éº„Ç∂„Éº -->
    <header class="dashboard__header">
        <div class="notification-area" aria-labelledby="notifications-page-title">
            <div class="notification-area__header-row">
                <div class="notification-area__header-title-section">
                    <h1 id="notifications-page-title">ÈÄöÁü•</h1>
                    <div class="notification-area__chips">
                        <div class="summary-chip summary-chip--alert" role="status" aria-live="polite">
                            <span class="summary-chip__icon" aria-hidden="true">üîî</span>
                            <span class="summary-chip__label">Êú™Á¢∫Ë™çÈÄöÁü•</span>
                            <strong class="summary-chip__count">{{ notificationsLoading() ? '‚Äî' : totalNotificationCount() }}‰ª∂</strong>
                        </div>
                        <div class="summary-chip summary-chip--success" role="status" aria-live="polite">
                            <span class="summary-chip__icon" aria-hidden="true">‚úÖ</span>
                            <span class="summary-chip__label">Êú¨Êó•Á∑†Âàá„ÉªÊú™ÂÆå‰∫Ü</span>
                            <strong class="summary-chip__count">{{ notificationsLoading() ? '‚Äî' : dueTodayTotalCount() }}‰ª∂</strong>
                        </div>
                        <button type="button" class="button button--ghost button--small" 
                            (click)="markAllNotificationsAsRead()"
                            [disabled]="notificationsLoading() || totalNotificationCount() === 0"
                            aria-label="„Åô„Åπ„Å¶Êó¢Ë™≠„Å´„Åô„Çã">
                            „Åô„Åπ„Å¶Êó¢Ë™≠
                        </button>
                    </div>
                </div>
                <div class="notification-area__header-controls">
                    <button type="button" class="button button--reload notification-area__reload" 
                        [class.notification-area__reload--loading]="reloadLoading()"
                        (click)="reloadDashboard()"
                        [disabled]="snapshotLoading() || notificationsLoading() || reloadLoading()"
                        aria-label="ÂÜçË™≠„ÅøËæº„Åø">
                        <span class="notification-area__reload-icon">‚Üª</span>
                    </button>
                    <button type="button" class="button button--accent" (click)="scrollToDailyWork()">
                        ‚è¨Êú¨Êó•„ÅÆ‰ªï‰∫ã
                    </button>
                    <button type="button" class="user-chip" (click)="goToUserSettings()">
                        <ng-container *ngIf="userPhotoUrl(); else userInitial">
                            <img [src]="userPhotoUrl()" alt="„É¶„Éº„Ç∂„Éº„Ç¢„Ç§„Ç≥„É≥">
                        </ng-container>
                        <ng-template #userInitial>
                            <span class="user-chip__placeholder">{{ userDisplayName().slice(0, 1) }}</span>
                        </ng-template>
                        <span class="user-chip__name">{{ userDisplayName() }}</span>
                    </button>
                </div>
            </div>
            <p class="notification-area__headline" [class.notification-area__headline--error]="notificationsError()">
                {{ notificationHeadline() }}
            </p>
            <p class="notification-area__headline notification-area__headline--warning" 
                *ngIf="notificationLimitWarning()"
                role="alert">
                ‚ö†Ô∏è {{ notificationLimitWarning() }}
            </p>
            <div class="notification-area__card">
                <div class="notification-card">
                    <p class="notification-card__state" *ngIf="notificationsLoading()">ÈÄöÁü•„ÇíË™≠„ÅøËæº„Åø‰∏≠„Åß„Åô‚Ä¶</p>
                    <p class="notification-card__state notification-card__state--error"
                        *ngIf="!notificationsLoading() && notificationsError()">
                        {{ notificationsError() }}
                    </p>
                    <ng-container *ngIf="!notificationsLoading() && !notificationsError()">
                        <ng-container *ngIf="notificationListItems() as notifications">
                            <p class="notification-card__state notification-card__state--empty"
                                *ngIf="notifications.length === 0">
                                Êú¨Êó•„ÅÆÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
                            </p>
                            <div class="notification-card__list" *ngIf="notifications.length > 0">
                                <button type="button" class="notification-item"
                                    [class.notification-item--read]="!item.isUnread"
                                    *ngFor="let item of notifications; trackBy: trackNotification"
                                    (click)="openNotification(item)">
                                    <span class="notification-item__marker"
                                        [ngClass]="{
                                            'notification-item__marker--mention': item.type === 'mention',
                                            'notification-item__marker--due-today': item.type === 'due_today',
                                            'notification-item__marker--overdue': item.type === 'overdue'
                                        }" aria-hidden="true"></span>
                                    <div class="notification-item__content">
                                        <div class="notification-item__header">
                                            <span class="notification-item__title"
                                                [class.notification-item__title--unread]="item.isUnread">
                                                {{ item.title }}
                                            </span>
                                            <span class="notification-item__tag"
                                                [ngClass]="'notification-item__tag--' + item.type">
                                                {{ getNotificationTagLabel(item.type) }}
                                            </span>
                                        </div>
                                        <span class="notification-item__description">{{ item.description }}</span>
                                    </div>
                                    <div class="notification-item__meta">
                                        <span class="notification-item__time">
                                            {{ item.timestamp ? (item.timestamp | date: 'M/d H:mm') : 'Êó•‰ªòÊú™Ë®≠ÂÆö' }}
                                        </span>
                                        <span class="notification-item__arrow" aria-hidden="true">‚Üó</span>
                                    </div>
                                </button>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard__widgets">
        <!-- „Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà‚ë†: „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Ç´„Éº„Éâ -->
        <section class="widget widget--projects" aria-labelledby="projects-title">
            <div class="widget__header">
                <h2 id="projects-title">„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÈÄ≤Êçó</h2>
                <div class="widget__actions">
                    <button type="button" class="button button--chip" *ngFor="let option of projectSortOptions"
                        [class.button--chip-active]="selectedSort() === option.value"
                        (click)="setProjectSort(option.value)">
                        {{ option.label }}
                    </button>
                </div>
            </div>
            <div class="widget__content widget__content--projects">
                <p class="widget__error" *ngIf="snapshotError()">{{ snapshotError() }}</p>
                <div class="widget__loading" *ngIf="snapshotLoading()">
                    <span class="spinner" aria-hidden="true"></span>
                    <span>Ë™≠„ÅøËæº„Åø‰∏≠...</span>
                </div>
                <p class="widget__empty" *ngIf="!snapshotLoading() && sortedProjectCards().length === 0">
                    Ë°®Á§∫„Åß„Åç„Çã„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
                </p>
                <ul class="project-list" *ngIf="!snapshotLoading() && sortedProjectCards().length > 0">
                    <li class="project-card" *ngFor="let project of (sortedProjectCards() | slice:0:2)"
                        [ngClass]="getWarningClass(project.warningLevel)">
                        <div class="project-card__header">
                            <h3>{{ project.name }}</h3>
                            <span class="project-card__members">„É°„É≥„Éê„Éº {{ project.memberCount }}</span>
                        </div>
                        <div class="project-card__body">
                            <div class="project-card__progress">
                                <svg viewBox="0 0 36 36" class="donut">
                                    <circle class="donut__bg" cx="18" cy="18" r="16"></circle>
                                    <circle class="donut__value" cx="18" cy="18" r="16"
                                        [attr.stroke-dasharray]="getCompletionDasharray(project)"></circle>
                                </svg>
                                <div class="project-card__progress-text">
                                    <strong>{{ project.progress | number: '1.0-0' }}%</strong>
                                    <span>{{ getProgressDelta(project) || 'ÈÄ≤ÊçóÁ¢∫Ë™çÊ∏à„Åø' }}</span>
                                </div>
                            </div>
                            <ul class="project-card__stats">
                                <li>Ë™≤È°å {{ project.issueCount }}</li>
                                <li>ÈáçË¶Å„Çø„Çπ„ÇØ {{ project.highPriorityBacklog }}</li>
                                <li>ÈÅÖÂª∂ {{ project.overdue ? '„ÅÇ„Çä' : '„Å™„Åó' }}</li>
                            </ul>
                            <div class="project-card__bars">
                                <div class="mini-bar" *ngFor="let bar of project.statusBars">
                                    <span class="mini-bar__label">{{ bar.label }}</span>
                                    <div class="mini-bar__track">
                                        <div class="mini-bar__fill"
                                            [style.width]="getProjectStatusWidth(project, bar.value)"></div>
                                    </div>
                                    <span class="mini-bar__value">{{ bar.value }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="project-card__footer">
                            <a class="button button--ghost" [routerLink]="['/projects', project.projectId]">Ë©≥Á¥∞„Å∏</a>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <!-- „Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà‚ë¢: „Éú„Éà„É´„Éç„ÉÉ„ÇØÊ§úÁü• -->
        <section class="widget widget--bottlenecks" aria-labelledby="bottleneck-title">
            <div class="widget__header">
                <h2 id="bottleneck-title">„Éú„Éà„É´„Éç„ÉÉ„ÇØÊ§úÁü•</h2>
                <span class="widget__hint">ÈÄ≤Êçó0%„ÄÅÈï∑Êúü‰øùÁïô„Å™„Å©„ÇíÊäΩÂá∫</span>
            </div>
            <div class="widget__content widget__content--bottlenecks">
                <p class="widget__empty" *ngIf="bottlenecks().length === 0">ÁèæÂú®Ê§úÂá∫„Åï„Çå„Åü„Éú„Éà„É´„Éç„ÉÉ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                <ul class="bottleneck-list" *ngIf="bottlenecks().length > 0">
                    <li class="bottleneck-item" *ngFor="let insight of bottlenecks(); trackBy: trackBottleneck"
                        [style.background-color]="getIssueThemeColorLight(insight.projectId, insight.issueId) || '#ffffff'"
                        [style.border-left-color]="getIssueThemeColorAccent(insight.projectId, insight.issueId)">
                        <div class="bottleneck-item__body">
                            <span class="bottleneck-item__type" [class.bottleneck-item__type--danger]="insight.severity === 'danger'"
                                [class.bottleneck-item__type--warning]="insight.severity === 'warning'"
                                [class.bottleneck-item__type--info]="insight.severity === 'info'">
                                <span class="bottleneck-item__badge">{{ insight.label }}</span>
                            </span>
                            <span class="bottleneck-item__id">{{ getProjectName(insight.projectId) }}<ng-container
                                    *ngIf="insight.issueId && getIssueName(insight.projectId, insight.issueId)"> / {{ getIssueName(insight.projectId, insight.issueId) }}</ng-container><ng-container
                                    *ngIf="insight.taskId && getTaskName(insight.projectId, insight.issueId, insight.taskId)"> / <span class="bottleneck-item__task-name">{{ getTaskName(insight.projectId, insight.issueId, insight.taskId) }}</span></ng-container></span>
                        </div>
                        <button type="button" class="button button--ghost" (click)="goToSmartFilter(insight)">
                            Á¢∫Ë™ç„Å∏
                        </button>
                    </li>
                </ul>
            </div>
        </section>

        <!-- „Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà‚ë£: Êé≤Á§∫Êùø„Éó„É¨„Éì„É•„Éº -->
        <section class="widget widget--board" aria-labelledby="board-title" id="daily-work-board">
            <div class="widget__header">
                <h2 id="board-title">Êé≤Á§∫Êùø„Éó„É¨„Éì„É•„Éº</h2>
                <div class="widget__actions">
                    <a routerLink="/board" class="button button--ghost">„ÇÇ„Å£„Å®Ë¶ã„Çã</a>
                  </div>
            </div>
            <div class="widget__content widget__content--board">
                <div class="widget__loading" *ngIf="bulletinLoading()">
                    <span class="spinner" aria-hidden="true"></span>
                    <span>Ë™≠„ÅøËæº„Åø‰∏≠...</span>
                </div>
                <p class="widget__error" *ngIf="!bulletinLoading() && bulletinError()">
                    {{ bulletinError() }}
                </p>
                 <app-board-preview
      *ngIf="!bulletinLoading() && !bulletinError()"
      [posts]="bulletinPosts()"
      [embedded]="true">
    </app-board-preview>
            </div>
        </section>

        <!-- „Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà‚ë§: Ë¶ÅÂØæÂøú„Çø„Çπ„ÇØ -->
        <section class="widget widget--deadlines" aria-labelledby="actionable-title" id="daily-work-actionable">
            <div class="widget__header">
                <h2 id="actionable-title">Ë¶ÅÂØæÂøú„Çø„Çπ„ÇØ</h2>
                <button type="button" class="button button--ghost" (click)="refreshActionableTasks()"
                    [disabled]="actionableLoading()">
                    ÂÜçË™≠„ÅøËæº„Åø
                </button>
            </div>
            <div class="widget__content widget__content--actionable">
                <div class="widget__loading" *ngIf="actionableLoading()">
                    <span class="spinner" aria-hidden="true"></span>
                    <span>Ë™≠„ÅøËæº„Åø‰∏≠...</span>
                </div>
                <p class="widget__error" *ngIf="!actionableLoading() && actionableError()">
                    {{ actionableError() }}
                </p>
                <p class="widget__empty"
                    *ngIf="!actionableLoading() && !actionableError() && actionableTasks().length === 0">
                    ÁèæÂú®ÂØæÂøú„ÅåÂøÖË¶Å„Å™„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
                </p>
                <ul class="actionable-list" *ngIf="!actionableLoading() && actionableTasks().length > 0">
                    <li class="actionable-card" *ngFor="let card of actionableTasks(); trackBy: trackTask"
                        [style.background-color]="getIssueThemeColorLight(card.projectId, card.issueId) || '#ffffff'"
                        [style.border-left-color]="getIssueThemeColorAccent(card.projectId, card.issueId)">
                        <div class="actionable-card__header">
                            <span class="actionable-card__badge" [style.background-color]="card.badge.color">
                                {{ card.badge.label }}
                            </span>
                            <span class="actionable-card__project" 
                                  [style.color]="getIssueThemeColorAccent(card.projectId, card.issueId)">
                                {{ card.projectName }}
                            </span>
                        </div>
                        <div class="actionable-card__body">
                            <div class="actionable-card__title-wrapper">
                                <h3 class="actionable-card__title" 
                                    tabindex="0"
                                    role="button"
                                    (click)="goToTaskDetail(card)"
                                    (keydown.enter)="goToTaskDetail(card)"
                                    (keydown.space)="goToTaskDetail(card); $event.preventDefault()">
                                    {{ card.title }}
                                </h3>
                                <div class="actionable-card__title-accent" 
                                     [style.background-color]="getIssueThemeColorAccent(card.projectId, card.issueId)">
                                </div>
                            </div>
                            <div class="actionable-card__meta">
                                <div class="actionable-card__meta-left">
                                    <span class="importance-chip" [ngClass]="getImportanceClass(card.importance)">
                                        {{ getImportanceLabel(card.importance) }}
                                    </span>
                                    <span class="status-badge" [ngClass]="'status-' + card.status">
                                        {{ card.statusLabel }}
                                    </span>
                                    <span class="due-label" *ngIf="card.dueDate">
                                        ÊúüÈôê: {{ card.dueDate | date: 'yyyy/MM/dd' }}
                                    </span>
                                </div>
                                <div class="actionable-card__actions">
                                    <button type="button" class="button button--ghost" (click)="markOnHold(card)"
                                        [disabled]="isUpdating(card)">
                                        ‰øùÁïô
                                    </button>
                                    <button type="button" class="button button--primary" (click)="markCompleted(card)"
                                        [disabled]="isUpdating(card)">
                                        ÂÆå‰∫Ü
                                    </button>
                                </div>
                            </div>
                            <div class="actionable-card__mentions" *ngIf="card.mentionCount > 0">
                                <h4>„É°„É≥„Ç∑„Éß„É≥ {{ card.mentionCount }}‰ª∂</h4>
                                <ul>
                                    <li *ngFor="let mention of card.mentions">
                                        <span class="mention-date">{{ mention.createdAt | date: 'MM/dd HH:mm' }}</span>
                                        <span class="mention-text">{{ mention.text }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </section>
    </div>
</section>