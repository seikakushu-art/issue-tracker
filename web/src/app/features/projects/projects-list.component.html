<div class="projects-container">
  <!-- ヘッダー -->
  <div class="header">
    <h1>プロジェクト一覧</h1>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="icon-plus"></i> 新規プロジェクト
    </button>
  </div>

  <!-- フィルター・並び替え -->
  <div class="filters">
    <div class="filter-group">
      <span>並び替え:</span>
      <select [(ngModel)]="sortBy" (change)="sortProjects()">
        <option value="name">名称</option>
        <option value="startDate">開始日</option>
        <option value="endDate">終了日</option>
        <option value="progress">進捗</option>
        <option value="createdAt">作成日</option>
        <option value="period">期間</option>
        <option value="issueCount">課題数</option>
        <option value="memberCount">メンバー数</option>
      </select>
      <select [(ngModel)]="sortOrder" (change)="sortProjects()">
        <option value="asc">昇順</option>
        <option value="desc">降順</option>
      </select>
    </div>
    <div class="filter-group">
      <label>
        <input type="checkbox" [(ngModel)]="showArchived" (change)="loadProjects()">
        アーカイブ済みも表示
      </label>
    </div>
  </div>

  <!-- プロジェクト一覧 -->
  <div class="projects-grid">
    <div 
      *ngFor="let project of filteredProjects" 
      class="project-card"
      [class.archived]="project.archived"
      role="button"
      tabindex="0"
      (click)="selectProject(project)"
      (keydown.enter)="selectProject(project)"
    >
      <div class="project-header">
        <h3>{{ project.name }}</h3>
        <div class="project-actions">
        <button class="btn-action" (click)="editProject(project, $event)" title="編集">
            <i class="icon-edit" aria-hidden="true"></i>
            <span class="action-label">編集</span>
          </button>
          <button class="btn-action" (click)="archiveProject(project, $event)" title="アーカイブ">
            <i class="icon-archive" aria-hidden="true"></i>
            <span class="action-label">{{ project.archived ? '復元' : 'アーカイブ' }}</span>
          </button>
        </div>
      </div>
      
      <div class="project-content">
        <p class="description" *ngIf="project.description">{{ project.description }}</p>
        
        <div class="project-meta">
          <div class="meta-item" *ngIf="project.startDate">
            <i class="icon-calendar"></i>
            {{ project.startDate | date:'yyyy/MM/dd' }}
          </div>
          <div class="meta-item" *ngIf="project.endDate">
            <i class="icon-calendar"></i>
            {{ project.endDate | date:'yyyy/MM/dd' }}
          </div>
          <div class="meta-item">
            <i class="icon-users"></i>
            {{ project.memberIds.length }}人
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-label">
            <span>進捗</span>
            <span class="progress-value">{{ project.progress || 0 }}%</span>
          </div>
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="project.progress || 0"
            ></div>
          </div>
        </div>

        <div class="project-stats">
          <div class="stat-item">
            <span class="stat-label">課題数</span>
            <span class="stat-value">{{ getIssueCount(project.id!) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">タスク数</span>
            <span class="stat-value">{{ getTaskCount(project.id!) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 空状態 -->
  <div *ngIf="projects.length === 0" class="empty-state">
    <i class="icon-folder"></i>
    <h3>プロジェクトがありません</h3>
    <p>新しいプロジェクトを作成して始めましょう</p>
    <button class="btn btn-primary" (click)="openCreateModal()">
      プロジェクトを作成
    </button>
  </div>
</div>

<!-- プロジェクト作成・編集モーダル -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()" role="button" tabindex="-1">
  <div class="modal" (click)="$event.stopPropagation()" role="button" tabindex="-1">
    <div class="modal-header">
      <h2>{{ editingProject ? 'プロジェクト編集' : '新規プロジェクト' }}</h2>
      <button
      class="btn-icon close-button"
      (click)="closeModal()"
      (keydown.enter)="closeModal()"
      aria-label="閉じる"
    >
      ×
      </button>
    </div>
    
    <form class="modal-body" (ngSubmit)="saveProject()">
      <div class="form-group">
        <label for="name">プロジェクト名 *</label>
        <input
          id="name"
          type="text" 
          [(ngModel)]="projectForm.name" 
          name="name"
          required
          placeholder="プロジェクト名を入力"
        >
      </div>
      
      <div class="form-group">
        <label for="description">説明</label>
        <textarea 
          id="description"
          [(ngModel)]="projectForm.description" 
          name="description"
          placeholder="プロジェクトの説明を入力"
          rows="3"
        ></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="startDate">開始日</label>
          <input 
            id="startDate"
            type="date" 
            [(ngModel)]="projectForm.startDate" 
            name="startDate"
          >
        </div>
        <div class="form-group">
          <label for="endDate">終了日</label>
    <input
            id="endDate"
            type="date" 
            [(ngModel)]="projectForm.endDate" 
            name="endDate"
          >
        </div>
      </div>
      
      <div class="form-group">
        <label for="goal">達成目標</label>
          <textarea 
            id="goal"
            [(ngModel)]="projectForm.goal" 
            name="goal"
            placeholder="プロジェクトの達成目標を入力"
            rows="2"
          ></textarea>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          キャンセル
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="!projectForm.name || saving">
          {{ saving ? '保存中...' : '保存' }}
        </button>
      </div>
    </form>
  </div>
</div>

