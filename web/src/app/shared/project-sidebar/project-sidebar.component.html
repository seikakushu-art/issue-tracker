<nav class="project-sidebar" [class.collapsed]="collapsed" aria-label="プロジェクト一覧">
    <!-- 見出しと作成ボタンをまとめる -->
    <div class="sidebar-header">
      <div class="sidebar-header__title-row">
        <h2>プロジェクト一覧</h2>
        <button 
          class="collapse-button" 
          type="button" 
          (click)="toggleCollapse()"
          [attr.aria-label]="collapsed ? 'サイドバーを展開' : 'サイドバーを折り畳み'"
          [attr.aria-expanded]="!collapsed"
        >
          <span class="collapse-button__icon" [class.collapsed]="collapsed" aria-hidden="true">◀</span>
        </button>
      </div>
      <button class="create-button" type="button" (click)="openCreateProject()" *ngIf="!collapsed">
        ＋ 新しいプロジェクトを作成
      </button>
    </div>

    <!-- 並び替えの操作群。画面本体と同じ選択肢を提供する。 -->
    <div class="sidebar-controls" aria-label="並び替え設定" *ngIf="!collapsed">
      <label class="sidebar-control">
        <span class="sidebar-control__label">並び替え:</span>
        <select [(ngModel)]="sortBy" (change)="onSortChange()">
          <option value="name">名称</option>
          <option value="startDate">開始日</option>
          <option value="endDate">終了日</option>
          <option value="progress">進捗</option>
          <option value="createdAt">作成日</option>
          <option value="period">期間</option>
          <option value="issueCount">課題数</option>
          <option value="memberCount">メンバー数</option>
        </select>
      </label>
      <label class="sidebar-control">
        <span class="sidebar-control__label sr-only">並び順</span>
        <select [(ngModel)]="sortOrder" (change)="onSortChange()">
          <option value="asc">昇順</option>
          <option value="desc">降順</option>
        </select>
      </label>
    </div>
  
    <!-- ローディング・エラー表示をこまめに切り替え -->
    <div *ngIf="loading && !collapsed" class="sidebar-message">読み込み中...</div>
    <div *ngIf="!loading && loadError && !collapsed" class="sidebar-message sidebar-message--error">{{ loadError }}</div>
    <div *ngIf="!loading && !loadError && projects.length === 0 && !collapsed" class="sidebar-message">
      まだ参加中のプロジェクトがありません
    </div>
  
    <!-- プロジェクト一覧本体 -->
    <ul *ngIf="!loading && !loadError && projects.length > 0 && !collapsed" class="project-list">
      <li
        *ngFor="let project of projects; trackBy: trackByProjectId"
        class="project-item"
      >
        <a
          class="project-link"
          [routerLink]="['/projects', project.id]"
          [class.active]="project.id === currentProjectId"
          [attr.aria-current]="project.id === currentProjectId ? 'page' : null"
        >
          <span class="project-name">{{ project.name }}</span>
          <span class="project-meta" *ngIf="project.progress !== undefined">
            進捗: {{ project.progress || 0 }}%
          </span>
        </a>
      </li>
    </ul>
  </nav>